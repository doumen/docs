<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:rich="http://richfaces.org/rich">

<composite:interface>
	<composite:attribute name="bean" />
</composite:interface>

<composite:implementation>
	<script type="text/javascript">  
		function moeda(z){  
			v = z.value;
			v = v.replace(/\D/g,"")  //permite digitar apenas números
			v = v.replace(/[0-9]{12}/,"inválido")   //limita pra máximo 999.999.999,99
			v = v.replace(/(\d{1})(\d{8})$/,"$1.$2")  //coloca ponto antes dos últimos 8 digitos
			v = v.replace(/(\d{1})(\d{5})$/,"$1.$2")  //coloca ponto antes dos últimos 5 digitos
			v = v.replace(/(\d{1})(\d{1,2})$/,"$1,$2")        //coloca virgula antes dos últimos 2 digitos
			z.value = 'R$ ' + v;
		}
		function mascaraCnpj(id){
			jQuery(id).mask("99.999.999/9999-99");
			}
		function mascaraCep(id){
			jQuery(id).mask("99.999-999");
			}
	</script>
	<p:panel id="pnlAssinantes" styleClass="pnlAssinantes">
		<h:panelGrid columns="6" styleClass="pnlgInformacao"
			columnClasses="pnlgInformacao_c1, pnlgInformacao_c2, pnlgInformacao_c3, pnlgInformacao_c4, pnlgInformacao_c5, pnlgInformacao_c6">
			<p:outputLabel value="Cód. Assinante" for="intCodAssinante" />
			<p:inputText id="intCodAssinante" styleClass="iptCodAss"
				value="#{cc.attrs.bean.selected.id}" disabled="true" />
			<p:outputLabel value="Data Inclusão" for="intDtInclusao"
				styleClass="oplDtInclusao" />
			<p:calendar id="intDtInclusao" styleClass="iptDtInclusao"
				value="#{cc.attrs.bean.selected.dataInclusao}" disabled="true"
				pattern="dd/MM/yyyy" />
			<p:outputLabel value="Tipo Inclusão" for="intTipoInclusao"
				styleClass="oplTpInclusao" />
			<p:inputText id="intTipoInclusao" styleClass="iptTpInclusao"
				value="#{cc.attrs.bean.tipoInclusao}" disabled="true" />
		</h:panelGrid>
		<p:tabView styleClass="tabDados">
			<p:tab title="Dados Assinantes">			
				<p:fieldset id="fdsDadosAssinantes" styleClass="dadosAssinantes">
						<h:panelGroup id="scriptMask"><h:outputScript>#{bean.script}</h:outputScript></h:panelGroup>												
					<h:panelGrid columns="2">
						<p:outputLabel value="Razão Social" for="intRazaoSocial" />
						<h:inputText id="intRazaoSocial" styleClass="iptDadosAssinantes"
							value="#{cc.attrs.bean.selected.razaoSocial}" />
						<p:outputLabel value="Endereço" for="intEndereco" />
						<h:panelGrid columns="3" styleClass="pnlgEndereco"
							columnClasses="pnlgEndereco_c1,pnlgEndereco_c2,pnlgEndereco_c3">
							<h:inputText id="intEndereco"
								value="#{cc.attrs.bean.selected.endereco}"
								styleClass="iptEndereco" />
							<p:outputLabel value="Nº " for="intNumero" styleClass="oplNumero" />
							<h:inputText id="intNumero"
								value="#{cc.attrs.bean.selected.enderecoNumero}"
								styleClass="iptNumero" mask="9?9999" />
						</h:panelGrid>
						<p:outputLabel value="Complemento" for="intComplemento" />
						<h:inputText id="intComplemento" styleClass="iptDadosAssinantes"
							value="#{cc.attrs.bean.selected.enderecoComplemento}" />
						<p:outputLabel value="Bairro" for="intBairro" />
						<h:panelGrid columns="3">
							<p:inputText id="intBairro" styleClass="iptBairro"
								value="#{cc.attrs.bean.selected.bairro}" />
							<p:outputLabel value="CEP" for="intCep" />
							<h:inputText id="intCep" value="#{cc.attrs.bean.selected.cepFormat}"
								onfocus="mascaraCep(this)" style="position:relative;left:0.6%;width:40%;"/>
						</h:panelGrid>
						<p:outputLabel value="Município" for="intMunicipio" />
						<h:panelGrid columns="3">
							<p:inputText id="intMunicipio"
								value="#{cc.attrs.bean.selected.municipio}" />
							<p:outputLabel value="UF" for="somUf" />
							<h:selectOneMenu id="somUf" value="#{cc.attrs.bean.selected.uf}"
								styleClass="selectUf">
								<f:selectItem itemLabel="" itemValue="#{null}"
									noSelectionOption="true" />
								<f:selectItems value="#{cc.attrs.bean.estados}" />
								<f:ajax event="change"
									listener="#{cc.attrs.bean.changeUfEvent}"
									render="intInscEst scriptMask" />
							</h:selectOneMenu>
						</h:panelGrid>
						<p:outputLabel value="CNPJ" for="intCnpj" />
						<h:panelGrid columns="3">
							<h:inputText id="intCnpj" value="#{cc.attrs.bean.selected.cnpj}"
								 onfocus="mascaraCnpj(this)"/>
							<p:outputLabel value="Inscr.Estadual" for="intInscEst" />
							<h:inputText id="intInscEst" onfocus="mascara(this)"
								value="#{bean.selected.inscricaoEstadual}">							
								 </h:inputText>
						</h:panelGrid>
					</h:panelGrid>
				</p:fieldset>
				<h:panelGrid columns="1">
					<p:fieldset id="fdsUsuarios" legend="Usuários"
						styleClass="dadosUsuarios">
						<p:messages id="msgs" />
						<h:panelGrid columns="6" styleClass="gridUsuarioAss"
							columnClasses="gUA_c1,gUA_c2,gUA_c3,gUA_c4,gUA_c5,gUA_c6">
							<p:outputLabel value="Usuário" for="intUsuario" />
							<p:inputText id="intUsuario" value="#{bean.login}">
								<p:ajax event="blur" update="intUsuario" />
							</p:inputText>
							<p:outputLabel value="Senha" for="pwdUsuario" />
							<p:password id="pwdUsuario" value="#{bean.senha}">
								<p:ajax event="blur" />
							</p:password>
							<h:commandButton id="cbIncluir" value=""
								style="background-image: url('resources/images/incluir.gif') !important;">
								<f:ajax event="click" listener="#{bean.adicionaUsuario}"
									  render="dtbUsuarios msgs scriptMask" />
							</h:commandButton>
							<h:commandButton id="cmbExcluir" value=""
								style="background-image: url('resources/images/minus.png') !important;">
								<f:ajax event="click" listener="#{bean.removeUsuario}"
									 render="dtbUsuarios" />
							</h:commandButton>
							<p:tooltip for="cmbExcluir" value="Excluir" />
							<p:tooltip for="cbIncluir" value="Incluir" />
						</h:panelGrid>
						<h:dataTable id="dtbUsuarios" styleClass="dataTableUsuariosAss"
							scrollable="true" scrollHeight="100"
							value="#{cc.attrs.bean.selected.usuarios}" var="usuario"
							emptyMessage="Nenhum registro encontrado.">
							<h:column headerText="ID">
								<h:outputText value="#{usuario.id}" />
							</h:column>
							<h:column headerText="Usuário">
								<h:outputText value="#{usuario.login}" />
							</h:column>
						</h:dataTable>
					</p:fieldset>
				</h:panelGrid>
			</p:tab>
			<p:tab title="Plano Contratação">
				<h:panelGrid columns="2">
					<p:outputLabel value="Cód.Plano" for="somCodPlano" />
					<h:selectOneMenu id="somCodPlano" value="#{bean.selected.plano}"
						styleClass="codPlanoAss" converter="planoConverter">
						<f:selectItem itemLabel="" itemValue="#{null}"
							noSelectionOption="true" />
						<f:selectItems value="#{bean.planos}" />
						<f:ajax event="change" render="intDescrPlano intValorMensal" />
					</h:selectOneMenu>
					<p:outputLabel value="Descr.Plano" for="intDescrPlano" />
					<p:inputText id="intDescrPlano"
						value="#{cc.attrs.bean.selected.plano.descricao}" disabled="true"
						styleClass="descPlanoAss" />
					<p:outputLabel value="Valor Mensal" for="intValorMensal" />
					<p:inputText id="intValorMensal"
						value="#{cc.attrs.bean.selected.plano.valorMensalFormatado}"
						styleClass="vlMensalAss" disabled="true">
					</p:inputText>
				</h:panelGrid>
			</p:tab>
			<p:tab title="Contabilidade">
				<h:panelGrid columns="2">
					<p:outputLabel value="Cód.Cont." for="somCodCont" />
					<h:selectOneMenu id="somCodCont"
						value="#{bean.selected.contabilidade}" styleClass="codContAss"
						converter="contabilidadeConverter">
						<f:selectItem itemLabel="" itemValue="#{null}"
							noSelectionOption="true" />
						<f:selectItems value="#{bean.contabilidades}" />
						<f:ajax event="change" render="intContCnpj intContRazaoSocial" />
					</h:selectOneMenu>
					<p:outputLabel value="CNPJ" for="intContCnpj" />
					<h:inputText id="intContCnpj" disabled="true"
						value="#{cc.attrs.bean.selected.contabilidade.cnpjFormatado}" onfocus="mascaraCnpj(this)"/>
					<p:outputLabel value="Razão Social" for="intContRazaoSocial" />
					<p:inputText id="intContRazaoSocial" disabled="true"
						value="#{cc.attrs.bean.selected.contabilidade.razaoSocial}"
						styleClass="razaoSocialAss" />
				</h:panelGrid>
			</p:tab>
			<p:tab title="Parametros">
				<h:panelGrid columns="3" styleClass="pngParametros"
					id="pngParametros"
					columnClasses="pngParametros_c1,pngParametros_c2,pngParametros_c3">
					<h:column>
						<p:outputLabel value="Certificado Digital A1"  />
					</h:column>
					<h:column>
						<p:outputLabel value="#{cc.attrs.bean.certificadoA1.nome}"
							rendered="#{bean.showUploadNome}" styleClass="uploadNome" />

						<h:commandButton value="Trocar Certificado" id="cdbTrocar"
							rendered="#{bean.showUploadNome}">
							<f:ajax event="click"
								listener="#{bean.trocarCertificado()}"
								process="@this" render="pngParametros" />
						</h:commandButton>
  						<h:panelGrid rendered="#{bean.showUpload}"><h:inputFile id="file" value="#{bean.file}" ></h:inputFile></h:panelGrid>
  					</h:column>
					<p:spacer />
					<h:outputLabel value="Senha" />
					<p:inputText styleClass="iptEmailMaster"
						value="#{bean.certificadoA1.senha}" />
					<p:spacer />
					<p:spacer />
					<h:panelGrid columns="2" styleClass="pngParametrosNotificar"
						columnClasses="pngParametrosNotificar_c1,pngParametrosNotificar_c2">
						<p:selectBooleanCheckbox id="ckbNotificar"
							value="#{cc.attrs.bean.certificadoA1.notificarExpiracaoCertificado}"
							styleClass="chkNotificar" />
						<p:outputLabel
							value="Notificar por e-mail quando o Certificado estiver próximo de expirar?"
							styleClass="oplNotificar" for="ckbNotificar" />
					</h:panelGrid>
					<p:spacer />
					<p:outputLabel value="E-mail Master" for="intEmailMaster" />
					<p:inputText id="intEmailMaster"
						value="#{cc.attrs.bean.selected.emailMaster}"
						styleClass="iptEmailMaster" />
					<p:tooltip for="intEmailMaster"
						value="Digite aqui o endereço de e-mail do responsável pelo Serviço no Assinante" />
					<p:spacer />
					<p:outputLabel
						value="Todas as atualizações, revisões, melhorias e notificações técnicas serão enviadas para este e-mail."
						styleClass="oplAviso" />
					<p:spacer />
					<p:outputLabel value="E-mail Financeiro" for="intEmailFinanceiro" />
					<p:inputText id="intEmailFinanceiro"
						value="#{cc.attrs.bean.selected.emailFinanceiro}"
						styleClass="iptEmailFinanceiro" />
					<p:tooltip for="intEmailFinanceiro"
						value="Digite aqui o endereço de e-mail do Assinante responsável pelo Financeiro/Contas a Pagar" />
					<p:spacer />
					<p:outputLabel
						value="Este endereço de e-mail receberá os Boletos e Notas Fiscais Referente a Assinatura Mensal"
						styleClass="oplAviso2" />
				</h:panelGrid>
			</p:tab>
		</p:tabView>
		<br />
		<div id="botaoIncluirAlterarAss">
			<h:commandButton value=" Incluir" action="#{bean.incluir}"
				id="cdbIncluir" rendered="#{bean.botaoIncluir}"
				style="background-image: url('resources/images/check.png') !important;"
				styleClass="botao_incluirAss" />
			<h:commandButton value=" Alterar" action="#{bean.alterar}"
				id="cdbAlterar" rendered="#{bean.botaoAlterar}"
				style="background-image: url('resources/images/check.png') !important;"
				styleClass="botao_incluirAss" />
		</div>
	</p:panel>
</composite:implementation>
</html>